/*!
 * oCanvas v1.0
 * http://ocanvas.org/
 *
 * Copyright 2011, Johannes Koggdal
 * Licensed under the MIT license
 * http://ocanvas.org/license
 */
(function(a,b,d){var e={domReady:function(a){/in/.test(b.readyState)?setTimeout("oCanvas.domReady("+a+")",10):a()},canvasList:[],modules:{},inits:{},plugins:{},core:function(a){this.id=e.canvasList.push(this)-1;for(var d in e.modules)typeof e.modules[d]=="function"?this[d]=Object.create(e.modules[d]()):this[d]=Object.create(e.modules[d]);this.settings={fps:30,background:"transparent",clearEachFrame:!0,drawEachFrame:!0,disableScrolling:!1,plugins:[]},e.extend(this.settings,a);if(this.settings.canvas.nodeName&&this.settings.canvas.nodeName.toLowerCase()==="canvas")this.canvasElement=this.settings.canvas;else if(typeof this.settings.canvas=="string")this.canvasElement=b.querySelector(this.settings.canvas);else return!1;this.canvas=c=this.canvasElement.getContext("2d");var f=this.canvasElement.width,g=this.canvasElement.height;this.__defineSetter__("width",function(a){f=isNaN(parseFloat(a))?f:parseFloat(a),this.canvasElement.width=f,this.redraw()}),this.__defineGetter__("width",function(){return f}),this.__defineSetter__("height",function(a){g=isNaN(parseFloat(a))?g:parseFloat(a),this.canvasElement.height=g,this.redraw()}),this.__defineGetter__("height",function(){return g});for(var d in e.modules){if(this[d].wrapper===!0)for(var h in this[d])typeof this[d][h]=="object"&&typeof this[d][h].setCore=="function"?this[d][h]=this[d][h].setCore(this):typeof this[d][h].setCore=="function"&&this[d][h].setCore(this),this[d].core=this;this[d].core=this}for(var i in e.inits)if(typeof e.inits[i]=="string"&&typeof this[i][e.inits[i]]=="function")this[i][e.inits[i]]();else if(e.inits[i]==="object")for(var j in e.inits[i])typeof this[i][e.inits[i][j]]=="function"&&this[i][e.inits[i][j]]();var k=this.settings.plugins;if(k.length>0)for(var l=0,m=k.length;l<m;l++)typeof e.plugins[k[l]]=="function"&&e.plugins[k[l]].call(this)},registerModule:function(a,b,c){if(~a.indexOf(".")){var f=a.split(".");e.modules[f[0]][f[1]]=b,c!==d&&(e.inits[f[0]]||(e.inits[f[0]]={}),e.inits[f[0]][f[1]]=c)}else e.modules[a]=b,c!==d&&(e.inits[a]=c)},registerPlugin:function(a,b){e.plugins[a]=b},create:function(a){return new e.core(a)}};e.core.prototype={addChild:function(a){a.add();return this},removeChild:function(a){a.remove();return this},clear:function(a){this.draw.clear(a);return this},redraw:function(){this.draw.redraw();return this},bind:function(a,b){this.events.bind(this.canvasElement,a,b);return this},unbind:function(a,b){this.events.unbind(this.canvasElement,a,b);return this},trigger:function(a){this.events.trigger(this.canvasElement,a);return this}},a.oCanvas=e,typeof Object.create!="function"&&(Object.create=function(a){function b(){}b.prototype=a;return new b}),a.log=function(){log.history=log.history||[],log.history.push(arguments);if(this.console){var a,b=Array.prototype.slice.call(arguments),c=b.length;for(a=0;a<c;a++)console.log(b[a])}},e.extend=function(){var a=Array.prototype.slice.call(arguments),b=a[a.length-1],c=a.splice(0,1)[0],d=a.splice(0,1)[0],f,g,h,i=[];b.exclude&&JSON.stringify(b)===JSON.stringify({exclude:b.exclude})&&(i=b.exclude);if(d!==b||i.length===0)for(f in d){if(~i.indexOf(f))continue;g=d.__lookupGetter__(f),h=d.__lookupSetter__(f),g||h?(g&&c.__defineGetter__(f,g),h&&c.__defineSetter__(f,h)):c[f]=d[f]}return a.length>0?e.extend.apply(this,[c].concat(a)):c};var f=function(){return{init:function(){var a=this;this.core.setLoop=function(b){a.userLoop=b;return a}},currentFrame:1,timeline:0,running:!1,set fps(a){this.core.settings.fps=a,this.running&&this.start()},get fps(){return this.core.settings.fps},loop:function(){typeof this.userLoop=="function"&&(this.core.settings.clearEachFrame===!0&&this.core.draw.clear(),this.userLoop.call(this.core,this.core.canvas),this.core.settings.drawEachFrame===!0&&this.core.draw.redraw(),this.currentFrame++)},start:function(){var a=this;clearInterval(a.timeline),a.timeline=setInterval(function(){a.loop()},1e3/a.fps),a.running=!0;return this},stop:function(){clearInterval(this.timeline),this.running=!1;return this}}};e.registerModule("timeline",f,"init");var g=function(){return{eventList:{keydown:[],keyup:[],keypress:[],running:[]},keysDown:{},keyPressTimer:0,keyPressRunning:!1,modifiedKeys:{},lastActiveKeyDown:!1,last_event:{},init:function(){var a=this;this.running=!1,this.core.events.types.keyboard=["keydown","keyup","keypress"],b.addEventListener("keydown",function(b){a.keydown.call(a,b)},!1),b.addEventListener("keyup",function(b){a.keyup.call(a,b)},!1),b.addEventListener("keypress",function(b){a.preventkeypress.call(a,b)},!1)},addEvent:function(a,b){return this.eventList[a].push(b)-1},removeEvent:function(a,b){this.eventList[a].splice(b,1)},getKeyCode:function(a){return a.keyCode===0?a.which:a.keyCode},numKeysDown:function(){var a=0,b=this.keysDown;for(var c in b)b[c]===!0&&a++;return a},anyKeysDown:function(){return this.numKeysDown()>0?!0:!1},getKeysDown:function(){var a=this.keysDown,b=[],c;for(c in a)a[c]===!0&&b.push(c);return b},triggerEvents:function(a,b){var c,d,e,f;if(this.core.mouse&&this.core.mouse.canvasFocused===!0){c=this.eventList[a],f=this.core.events.modifyEventObject(b,a);for(d=c.length;d--;)e=c[d],typeof e=="function"&&e(f)}},keydown:function(a){this.last_event=a;var b=this;this.keysDown[this.getKeyCode(a)]!==!0&&(this.lastActiveKeyDown=this.getKeyCode(a),this.keysDown[this.lastActiveKeyDown]=!0,this.triggerEvents("keydown",a),clearInterval(this.keyPressTimer),this.keyPressRunning=!1,!this.keyPressRunning&&this.eventList.keypress.length>0&&(this.keyPressTimer=setInterval(function(){b.keypress(a)},1e3/this.core.settings.fps),this.keyPressRunning=!0),this.preventkeypress(a))},keyup:function(a){this.last_event=a;var b=this.getKeyCode(a);b===this.lastActiveKeyDown&&(this.lastActiveKeyDown=!1),delete this.keysDown[b],this.triggerEvents("keyup",a),this.anyKeysDown()||(clearInterval(this.keyPressTimer),this.keyPressRunning=!1)},keypress:function(a){this.last_event=a,this.triggerEvents("keypress",a)},preventkeypress:function(a){var b,c,d;if(this.core.mouse&&this.core.mouse.canvasFocused===!0){b=this.getKeyCode(a),c=this.modifiedKeys;for(d in c)b===d&&c[d]!==!1&&a.preventDefault()}},ARROW_UP:38,ARROW_DOWN:40,ARROW_LEFT:37,ARROW_RIGHT:39,SPACE:32,ENTER:13,ESC:27}};e.registerModule("keyboard",g,"init");var h=function(){return{eventList:{mousemove:[],mouseenter:[],mouseleave:[],click:[],mousedown:[],mouseup:[],drag:[]},last_event:{},cursorValue:"default",init:function(){var c=this,d=this.core,e=d.canvasElement,f;d.events.types.mouse=f=["mousemove","mouseenter","mouseleave","mousedown","mouseup","click"],d.events.pointers.mouse=function(c,d){~f.indexOf(c)&&!("ontouchstart"in a||"createTouch"in b)&&d("mouse","click")},d.pointer=this,this.x=0,this.y=0,this.buttonState="up",this.canvasFocused=!1,this.canvasHovered=!1,this.cancel(),e.addEventListener("mousemove",function(a){c.mousemove.call(c,a)},!1),e.addEventListener("mousedown",function(a){c.mousedown.call(c,a)},!1),e.addEventListener("mouseup",function(a){c.mouseup.call(c,a)},!1),b.addEventListener("mouseup",function(a){c.docmouseup.call(c,a)},!1),b.addEventListener("mouseover",function(a){c.docmouseover.call(c,a)},!1),b.addEventListener("mousedown",function(a){c.docmousedown.call(c,a)},!1),parent!==a&&parent.document.addEventListener("mouseover",function(a){c.docmouseover.call(c,a)},!1)},addEvent:function(a,b){return this.eventList[a].push(b)-1},removeEvent:function(a,b){this.eventList[a].splice(b,1)},getPos:function(a){var c,e,f=this.core.canvasElement.getBoundingClientRect();a.pageX!==d&&a.pageY!==d?(c=a.pageX-b.documentElement.scrollLeft-Math.round(f.left),e=a.pageY-b.documentElement.scrollTop-Math.round(f.top)):a.clientX!==d&&a.clientY!==d&&(c=a.clientX+b.documentElement.scrollLeft-Math.round(f.left),e=a.clientY+b.documentElement.scrollTop-Math.round(f.top));return{x:c,y:e}},updatePos:function(a){var b=this.getPos(a);this.x=b.x,this.y=b.y;return b},onCanvas:function(a){a=a||this.last_event;var b=a?this.getPos(a):{x:this.x,y:this.y};if(b.x>=0&&b.x<=this.core.width&&b.y>=0&&b.y<=this.core.height){this.canvasHovered=!0,this.updatePos(a);return!0}this.canvasHovered=!1;return!1},triggerEvents:function(a,b,c){c=c||!1;var d=this.eventList[a],e,f,g=this.core.events.modifyEventObject(b,a);g.x=this.x,g.y=this.y,g.button===0&&~"mousedown mouseup click".indexOf(a)?g.which=1:g.button===2?g.which=2:g.button===1?g.which=3:g.which=0;for(e=d.length;e--;)f=d[e],typeof f=="function"&&f(g,c)},mousemove:function(a){this.last_event=a,this.updatePos(a),this.canvasHovered=!0,this.triggerEvents("mouseenter",a),this.triggerEvents("mousemove",a),this.triggerEvents("mouseleave",a),this.triggerEvents("drag",a)},mousedown:function(a){this.canvasFocused=!0,this.last_event=a,this.start_pos=this.getPos(a),this.buttonState="down",this.triggerEvents("mousedown",a);return!1},mouseup:function(a){this.last_event=a,this.buttonState="up",this.triggerEvents("mouseup",a),this.triggerEvents("click",a),this.cancel()},docmouseup:function(a){this.last_event=a,this.buttonState==="down"&&!this.onCanvas(a)&&this.mouseup(a)},docmouseover:function(a){this.last_event=a,this.onCanvas(a)||this.triggerEvents("mouseleave",a,!0)},docmousedown:function(a){this.last_event=a,this.onCanvas(a)||(this.canvasFocused=!1)},cancel:function(){this.start_pos={x:-10,y:-10};return this},hide:function(){this.core.canvasElement.style.cursor="none";return this},show:function(){this.core.canvasElement.style.cursor=this.cursorValue;return this},cursor:function(a){if(~a.indexOf("url(")){var b=/url\((.*?)\)(\s(.*?)\s(.*?)|)($|,.*?$)/.exec(a),c=b[5]?b[5]:"";a="url("+b[1]+") "+(b[3]?b[3]:0)+" "+(b[4]?b[4]:0)+(c!==""?c:", default")}this.core.canvasElement.style.cursor=a,this.cursorValue=a;return this}}};e.registerModule("mouse",h,"init");var i=function(){return{eventList:{touchstart:[],touchend:[],touchmove:[],touchenter:[],touchleave:[],tap:[]},last_event:{},init:function(){var c=this,d=this.core,e=d.canvasElement,f,g="ontouchstart"in a||"createTouch"in b;d.events.types.touch=f=["touchstart","touchend","touchmove","touchenter","touchleave","tap"],d.events.pointers.touch=function(a,b){~f.indexOf(a)&&g&&b("touch","tap")},g&&(d.pointer=this,e.style.WebkitUserSelect="none",e.style.WebkitTouchCallout="none",e.style.WebkitTapHighlightColor="rgba(0,0,0,0)"),this.x=-1,this.y=-1,this.touchState="up",this.canvasFocused=!1,this.canvasHovered=!1,this.cancel(),e.addEventListener("touchmove",function(a){c.touchmove.call(c,a)},!1),e.addEventListener("touchstart",function(a){c.touchstart.call(c,a)},!1),e.addEventListener("touchend",function(a){c.touchend.call(c,a)},!1),d.settings.disableScrolling&&e.addEventListener("touchmove",function(a){c.doctouchmove.call(c,a),a.preventDefault()},!1),b.addEventListener("touchend",function(a){c.doctouchend.call(c,a)},!1),b.addEventListener("touchmove",function(a){c.doctouchmove.call(c,a)},!0),b.addEventListener("touchstart",function(a){c.doctouch.call(c,a)},!0)},addEvent:function(a,b){return this.eventList[a].push(b)-1},removeEvent:function(a,b){this.eventList[a].splice(b,1)},getPos:function(a){var b,c;if(a.touches!==d){var e=this.core.canvasElement.getBoundingClientRect(),f=a.touches.length;a.touches.length>0&&(a=a.touches[0],a.pageX&&a.pageY?(b=a.pageX-(Math.round(e.left)<0?0:Math.round(e.left)),c=a.pageY-(Math.round(e.top)<0?0:Math.round(e.top))):(b=this.x,c=this.y))}else b=this.x,c=this.y;return{x:b,y:c}},updatePos:function(a){var b=this.getPos(a);this.x=b.x,this.y=b.y;return b},onCanvas:function(a){a=a||this.last_event;var b=a?this.getPos(a):{x:this.x,y:this.y};if(b.x>=0&&b.x<=this.core.width&&b.y>=0&&b.y<=this.core.height){this.canvasHovered=!0,this.updatePos(a);return!0}this.canvasHovered=!1;return!1},triggerEvents:function(a,b,c){c=c||!1;var d=this.eventList[a],e,f,g=this.core.events.modifyEventObject(b,a);g.x=this.x,g.y=this.y,g.which=0;for(e=d.length;e--;)f=d[e],typeof f=="function"&&f(g,c)},touchmove:function(a){this.last_event=a,this.onCanvas(a)&&(this.canvasHovered=!0,this.triggerEvents("touchenter",a),this.triggerEvents("touchmove",a),this.triggerEvents("touchleave",a))},touchstart:function(a){this.canvasFocused=!0,this.last_event=a,this.onCanvas(a)&&(this.start_pos=this.updatePos(a),this.touchState="down",this.triggerEvents("touchenter",a),this.triggerEvents("touchstart",a));return!1},touchend:function(a){this.last_event=a,this.touchState="up",this.triggerEvents("touchleave",a,!0),this.triggerEvents("touchend",a),this.triggerEvents("tap",a),this.cancel()},doctouchend:function(a){this.touchState==="down"&&!this.onCanvas(a)&&this.touchend(a)},doctouchmove:function(a){this.canvasHovered&&!this.onCanvas(a)&&this.triggerEvents("touchleave",a,!0)},doctouch:function(a){this.onCanvas(a)||(this.canvasFocused=!1)},cancel:function(){this.start_pos={x:-10,y:-10};return this}}};e.registerModule("touch",i,"init");var j=function(){return{transformPointerPosition:function(a,b,c,d,e){d=d||0,e=e||this.core.pointer;if(typeof a=="object"){var f=a.parent,g=[],h,i,j={x:0,y:0},k;g.push(a);while(f)g.push(f),f=f.parent;g.reverse(),h=e;for(n=0,l=g.length;n<l;n++)i=g[n],j=this.transformPointerPosition(i.rotation,i.abs_x,i.abs_y,0,h),h=j;d!==0&&(k=a.getOrigin(),j=this.transformPointerPosition(d*-1,b,c,0,h));return{x:j.x,y:j.y}}var m=a,o=e.x>=b&&e.y<=c,p=e.x>=b&&e.y>=c,q=e.x<=b&&e.y>=c,r=e.x<=b&&e.y<=c,s=Math.sqrt(Math.pow(e.x-b,2)+Math.pow(e.y-c,2)),m=(m/360-Math.floor(m/360))*360-d,t,u,v,w=s===0?0:Math.abs(e.y-c)/s;if(o||q)t=(180-m-Math.asin(w)*180/Math.PI)*Math.PI/180,u=b+Math.cos(t)*s*(o?-1:1),v=c+Math.sin(t)*s*(o?-1:1);else if(r||p)t=(Math.asin(w)*180/Math.PI-m)*Math.PI/180,u=b+Math.cos(t)*s*(r?-1:1),v=c+Math.sin(t)*s*(r?-1:1);return{x:u,y:v}},isPointerInside:function(a,b){var c=a.getOrigin();if(a.type==="line"){var d=Math.abs(a.end.x-a.abs_x),e=Math.abs(a.end.y-a.abs_y),f=Math.sqrt(d*d+e*e),g=Math.asin(e/f)*180/Math.PI,h=this.transformPointerPosition(a,a.abs_x,a.abs_y,g*-1,b);return h.x>a.abs_x-f-c.x&&h.x<a.abs_x+f-c.x&&h.y>a.abs_y-a.strokeWidth/2-c.y&&h.y<a.abs_y+a.strokeWidth/2-c.y}if(a.type==="text"){var h=this.transformPointerPosition(a,a.abs_x,a.abs_y,0,b),i=a.strokeWidth/2,j,k,l,m;a.align==="left"?(j=a.abs_x,k=a.abs_x+a.width):a.align==="center"?(j=a.abs_x-a.width/2,k=a.abs_x+a.width/2):a.align==="right"?(j=a.abs_x-a.width,k=a.abs_x):a.align==="start"?this.core.canvasElement.dir==="rtl"?(j=a.abs_x-a.width,k=a.abs_x):(j=a.abs_x,k=a.abs_x+a.width):a.align==="end"&&(this.core.canvasElement.dir==="rtl"?(j=a.abs_x,k=a.abs_x+a.width):(j=a.abs_x-a.width,k=a.abs_x)),a.baseline==="top"?l=a.abs_y:a.baseline==="hanging"?l=a.abs_y-a.height*.19:a.baseline==="middle"?l=a.abs_y-a.height*.5:a.baseline==="alphabetic"?l=a.abs_y-a.height*.79:a.baseline==="ideographic"?l=a.abs_y-a.height*.84:a.baseline==="bottom"&&(l=a.abs_y-a.height),m=l+a.height;return h.x>j-c.x-i&&h.x<k-c.x+i&&h.y>l-c.y-i&&h.y<m-c.y+i}if(a.shapeType==="rectangular"){var h=this.transformPointerPosition(a,a.abs_x,a.abs_y,0,b),i=a.strokePosition==="outside"?a.strokeWidth:a.strokePosition==="center"?a.strokeWidth/2:0;return h.x>a.abs_x-c.x-i&&h.x<a.abs_x+a.width-c.x+i&&h.y>a.abs_y-c.y-i&&h.y<a.abs_y+a.height-c.y+i}if(a.type==="ellipse"&&a.radius_x===a.radius_y){var h=this.transformPointerPosition(a,a.abs_x,a.abs_y,0,b),f=Math.sqrt(Math.pow(h.x-a.abs_x+c.x,2)+Math.pow(h.y-a.abs_y+c.y,2));return f<a.radius_x+a.strokeWidth/2}if(a.type==="ellipse"){var h=this.transformPointerPosition(a,a.abs_x,a.abs_y,0,b),n=a.radius_x+a.strokeWidth/2,o=a.radius_y+a.strokeWidth/2;h.x-=a.abs_x+c.x,h.y-=a.abs_y+c.y;return h.x*h.x/(n*n)+h.y*h.y/(o*o)<1}if(a.type==="polygon"){var h=this.transformPointerPosition(a,a.abs_x,a.abs_y,0,b),p=a.radius+a.strokeWidth/2,q=a.sides,r=q-1,s=!1,t,u,v;for(t=0;t<q;t++)u={x:a.abs_x-c.x+p*Math.cos(t*2*Math.PI/q),y:a.abs_y-c.y+p*Math.sin(t*2*Math.PI/q)},v={x:a.abs_x-c.x+p*Math.cos(r*2*Math.PI/q),y:a.abs_y-c.y+p*Math.sin(r*2*Math.PI/q)},(u.y<h.y&&v.y>=h.y||v.y<h.y&&u.y>=h.y)&&u.x+(h.y-u.y)/(v.y-u.y)*(v.x-u.x)<h.x&&(s=!s),r=t;return s}if(a.type==="arc"){var w=a.direction==="clockwise"?a.end-a.start:Math.abs(a.end-a.start),x=a.direction==="clockwise"?a.start*-1:a.end*-1,h=this.transformPointerPosition(a,a.abs_x-c.x,a.abs_y-c.y,x,b),f=Math.sqrt(Math.pow(h.x-a.abs_x+c.x,2)+Math.pow(h.y-a.abs_y+c.y,2)),p=a.radius,y={},z={},n,A,B,g;if(a.strokeWidth===0&&f>p||a.strokeWidth>0&&f>p+a.strokeWidth/2)return!1;if(p===a.strokeWidth/2){if(w>180){var C,D,E,F;C=Math.abs(a.abs_x-c.x-h.x),D=Math.abs(a.abs_y-c.y-h.y),E=Math.sqrt(C*C+D*D),F=Math.acos(C/E)*180/Math.PI;return h.y>=a.abs_y-c.y&&f<=a.strokeWidth?!0:h.y<a.abs_y-c.y&&h.x<a.abs_x-c.x&&F<=w-180?!0:!1}if(w===180)return h.y>=a.abs_y-c.y&&f<=a.strokeWidth?!0:!1;if(w<180){x=90-w/2-(a.direction==="clockwise"?a.start:a.end),h=this.transformPointerPosition(a,a.abs_x-c.x,a.abs_y-c.y,x,b);var G,C,D,E,F;p*=2,G=Math.cos(w/2*Math.PI/180)*p,C=Math.abs(a.abs_x-c.x-h.x),D=Math.abs(a.abs_y-c.y-h.y),E=Math.sqrt(C*C+D*D),F=Math.asin(C/E)*180/Math.PI;return h.y>=a.abs_y-c.y+G?!0:h.y>=a.abs_y-c.y&&F<=w/2?!0:!1}}else{if(w>180){n=(360-w)/2,A=Math.cos(n*Math.PI/180)*p,y.x=a.abs_x-c.x+Math.cos(n*Math.PI/180)*A,y.y=a.abs_y-c.y-Math.sin(n*Math.PI/180)*A,B=180-2*n,z.x=a.abs_x-c.x-Math.cos(B*Math.PI/180)*p,z.y=a.abs_y-c.y-Math.sin(B*Math.PI/180)*p;var H=90-(90-B)-(90-n);if(h.y<y.y&&h.x<y.x)g=n-Math.acos(Math.abs(h.y-y.y)/Math.sqrt(Math.pow(h.x-y.x,2)+Math.pow(h.y-y.y,2)))*180/Math.PI;else if(h.y>y.y&&h.x>=y.x)g=H-Math.acos(Math.abs(h.x-y.x)/Math.sqrt(Math.pow(h.x-y.x,2)+Math.pow(h.y-y.y,2)))*180/Math.PI;else{if(h.y<a.abs_y-c.y&&h.x>=y.x)return!1;g=-1e6}return g<=0&&h.x>=z.x&&h.y>y.y&&h.y<a.abs_y-c.y?!0:g<=0&&h.y<=a.abs_y-c.y&&f<=p?!0:(a.strokeWidth===0&&f<=p||a.strokeWidth>0&&f<=p+a.strokeWidth/2)&&(h.x<=z.x&&h.y<=a.abs_y-c.y||h.y>=a.abs_y-c.y)?!0:!1}if(w===180)return h.y>=a.abs_y-c.y&&(a.strokeWidth===0&&f<=p||a.strokeWidth>0&&f<=p+a.strokeWidth/2)?!0:!1;if(w<180){x=90-w/2-(a.direction==="clockwise"?a.start:a.end),h=this.transformPointerPosition(a,a.abs_x-c.x,a.abs_y-c.y,x,b);var I,G;I=a.fill===""?p-a.strokeWidth/2:p,G=Math.cos(w/2*Math.PI/180)*I;return a.fill===""&&a.strokeWidth>0?h.y>=a.abs_y-c.y+G&&f>=p-a.strokeWidth/2&&f<=p+a.strokeWidth/2?!0:!1:h.y>=a.abs_y-c.y+G?a.strokeWidth>0?f<=p+a.strokeWidth/2?!0:!1:!0:!1}}}else if(a.shapeType==="radial"){var p=a.radius?a.radius:0;if(p>0){var h=this.transformPointerPosition(a,a.abs_x,a.abs_y,0,b),c=a.getOrigin(),f=Math.sqrt(Math.pow(h.x-a.abs_x+c.x,2)+Math.pow(h.y-a.abs_y+c.y,2));return f<p}}}}};e.registerModule("tools",j);var k=function(){return{types:{},pointers:{},init:function(){this.core.canvasElement.events={},this.core.canvasElement.drawn=!0,this.core.canvasElement.isPointerInside=function(){return!0}},bind:function(a,b,c){var e=this.core,f,g,h,b=b.split(" "),i,j,k;for(i=0;i<b.length;i++){j=b[i];if(this.types.keyboard&&~this.types.keyboard.indexOf(j))h=this.core.keyboard.addEvent(j,c),a.events[j]===d&&(a.events[j]={}),a.events[j][h]=c;else for(k in this.pointers)this.pointers[k](j,function(b){return function(f,i){a.events[b]===d&&(a.events[b]={}),g=function(g,h){if(!!a.drawn)if(a.isPointerInside()&&!h){if(b!==f+"leave"){if(b===f+"enter"&&a.events[f+"ontarget"])return;if(b===i&&(e.pointer.start_pos.x<0||e.pointer.start_pos.y<0||!a.isPointerInside(e.pointer.start_pos)))return;b!=="touchend"&&(a.events[f+"ontarget"]=!0),c.call(a.nodeName!==d?e:a,g)}}else b===f+"leave"&&a.events[f+"ontarget"]&&(a.events[f+"ontarget"]=!1,c.call(a,g))},h=e[f].addEvent(b,g),a.events[b][h]=c}}(j))}},unbind:function(a,b,c){var e,f,g,h,i,j;b=b.split(" ");for(e=0;e<b.length;e++){f=b[e];if(a.events[f]===d)continue;for(g in this.types)if(~this.types[g].indexOf(f)){h=g;break}for(i in a.events[f])a.events[f][i]===c&&(j=i);j!==d&&(delete a.events[f][j],this.core[h].removeEvent(f,j))}},trigger:function(a,b){var c,e,f,g;b=b.split(" ");for(c=0;c<b.length;c++){e=b[c],g=a.events[e];if(g!==d)for(f in g)~this.types.keyboard.indexOf(e)?g[f].call(a,this.core.keyboard.last_event):g[f].call(a,this.core.pointer.last_event);else~e.indexOf("cancel")&&this.core[e.replace("cancel","")].cancel()}},modifyEventObject:function(a,b){var c="altKey ctrlKey metaKey shiftKey button charCode keyCode clientX clientY layerX layerY pageX pageY screenX screenY detail eventPhase isChar touches targetTouches changedTouches scale rotation".split(" "),e=c.length,f,g,h;f={originalEvent:a,type:b,timeStamp:(new Date).getTime(),which:a.which===0?a.keyCode:a.which,preventDefault:function(){a.preventDefault()},stopPropagation:function(){a.stopPropagation()}};for(g=0;g<e;g++)h=c[g],a[h]!==d&&(f[h]=a[h]);f.preventDefault;return f}}};e.registerModule("events",k,"init");var m=function(){return{objects:{},drawn:{},lastObjectID:0,translation:{x:0,y:0},add:function(a){var b=++this.lastObjectID;this.objects[b]=a,this.drawn[b]=!1;return b},remove:function(a){this.objects[a]!==d&&(this.objects[a].drawn=!1,delete this.objects[a],delete this.drawn[a],this.redraw())},clear:function(a){var b=this.objects,c;a===d||a===!0?this.core.background.redraw():this.core.canvas.clearRect(0,0,this.core.width,this.core.height);for(c in b)b[c].drawn=!1;return this},redraw:function(a){a=a||!1;var b=this.core.canvas,c=this.objects,e,f,g,h,i,j,k,l,m,n,o,p;(this.core.settings.clearEachFrame||a)&&this.clear();for(e in c){f=c[e];if(f!==d&&typeof f.draw=="function"){typeof f.update=="function"&&f.update(),b.save(),j=[],j.push(f),o=f.parent;while(o)j.push(o),o=o.parent;j.reverse(),k=0,l=0;for(m=0,n=j.length;m<n;m++)g=j[m],b.translate(g.abs_x-k,g.abs_y-l),g.rotation!==0&&b.rotate(g.rotation*Math.PI/180),k=g.abs_x,l=g.abs_y;this.translation={x:k,y:l},h=f.abs_x,i=f.abs_y,f._.abs_x=0,f._.abs_y=0,(f.scalingX!==1||f.scalingY!==1)&&b.scale(f.scalingX,f.scalingY),b.globalAlpha=isNaN(parseFloat(f.opacity))?1:parseFloat(f.opacity),b.globalCompositeOperation=f.composition,p=f.shadow,p.blur>0&&(b.shadowOffsetX=p.offsetX,b.shadowOffsetY=p.offsetY,b.shadowBlur=p.blur,b.shadowColor=p.color),b.lineCap=f.cap,b.lineJoin=f.join,b.miterLimit=f.miterLimit,f.draw(),this.drawn[e]=!0,f.drawn=!0,f._.abs_x=h,f._.abs_y=i,b.lineCap="butt",b.lineJoin="miter",b.miterLimit=10,b.restore(),this.translation={x:0,y:0}}}return this}}};e.registerModule("draw",m);var o=function(){return{bg:"",value:"",type:"transparent",loaded:!1,init:function(){this.set(this.core.settings.background)},set:function(a){var b=this;typeof a!="string"&&(a=""),this.value=a,~a.indexOf("gradient")?this.type="gradient":~a.indexOf("image")?this.type="image":this.core.style&&this.core.style.isColor(a)?this.type="color":this.type="transparent";if(this.type==="color")this.bg=a,this.core.timeline&&!this.core.timeline.running&&this.core.draw.redraw(!0),this.loaded=!0;else if(this.type==="gradient")this.bg=this.core.style?this.core.style.getGradient(a,0,0,this.core.width,this.core.height):"",this.core.timeline&&!this.core.timeline.running&&this.core.draw.redraw(!0),this.loaded=!0;else if(this.type==="image"){var c=/image\((.*?)(,(\s|)(repeat|repeat-x|repeat-y|no-repeat)|)\)/.exec(a),d=c[1],e=c[4]||"repeat",f=new Image;f.src=d,f.onload=function(){b.bg=b.core.canvas.createPattern(this,e),b.loaded=!0,b.core.timeline&&!b.core.timeline.running&&b.core.redraw(!0)}}else this.redraw(!0),this.loaded=!0;return this},redraw:function(a){var b=this.core;this.type!=="transparent"?(b.canvas.fillStyle=this.bg,b.canvas.fillRect(0,0,b.width,b.height)):b.canvas.clearRect(0,0,b.width,b.height)}}};e.registerModule("background",o,"init");var p=function(){return{current:"none",scenes:{},create:function(a,b){this.scenes[a]=Object.create(this.scenesBase()),this.scenes[a].name=a,b.call(this.scenes[a]);return this.scenes[a]},scenesBase:function(){return{name:"",objects:[],loaded:!1,add:function(a){this.objects.push(a),this.loaded&&a.add();return this},remove:function(a){var b=this.objects.indexOf(a);~b&&(this.objects.splice(b,1),this.loaded&&a.remove());return this},load:function(){if(!this.loaded){var a=this.objects,b,c=a.length;for(b=0;b<c;b++)a[b]!==d&&a[b].add();this.loaded=!0;return this}},unload:function(){var a=this.objects,b,c=a.length;for(b=0;b<c;b++)a[b]!==d&&a[b].remove();this.loaded=!1;return this}}},load:function(a,b){b===!0&&this.current!=="none"&&this.unload(this.current),this.current=a,this.scenes[a].load();return this},unload:function(a){this.current="none",this.scenes[a].unload();return this}}};e.registerModule("scenes",p);var q=function(){return{getStroke:function(a,b){b=b==="string"?"string":"object";if(typeof a=="object"&&b==="string"){var c=a;a=typeof c.pos=="string"?c.pos:"center",a+=" "+(typeof c.width=="number"?c.width+"px":"1px"),a+=" "+(typeof c.color=="string"?c.color:"#000000")}var d=a.split(" "),e=["outside","center","inside"],f="",g,h=d.length,i,j,k,l;if(h>=3)if(!~e.indexOf(d[0])){l=isNaN(parseInt(d[0]));for(g=l?0:1;g<h;g++)f+=d[g];l?d=[1,f]:d=[d[0],f],h=2}else{if(h>3){for(g=2;g<h;g++)f+=d[g];d=[d[0],d[1],f]}d={pos:d[0],width:parseInt(d[1]),color:d[2]}}h===2&&(d={pos:"center",width:parseInt(d[0]),color:d[1]}),d.length&&(d={width:0});if(b==="string")return d.pos+" "+d.width+"px "+d.color;if(b==="object")return d},getGradient:function(a,b,c,d,e){return~a.indexOf("linear")?this.getLinearGradient(a,b,c,d,e):~a.indexOf("radial")?this.getRadialGradient(a,b,c,d,e):"transparent"},getLinearGradient:function(a,b,c,d,e){var f,g,h,i=[],j,k,l,m,n,o,p=["top","bottom","left","right"],q,r,s=[],t,u;g=/\((.*)\)/.exec(a)[1];while(q=/((hsl|hsla|rgb|rgba)\(.*?\))/.exec(g))r=s.push(q[1])-1,g=g.substring(0,q.index)+"###"+r+"###"+g.substring(q.index+q[1].length,g.length);g=g.split(","),h=g[0].split(" "),(~p.indexOf(h[0])||~h[0].indexOf("deg"))&&i.push(h[0]),h.length>1&&~p.indexOf(h[1])&&i.push(h[1]),i.length===0?i.push("top"):k=1;if(i.length===1){if(i[0]==="top")l=b+d/2,m=c,n=b+d/2,o=c+e;else if(i[0]==="right")l=b+d,m=c+e/2,n=b,o=c+e/2;else if(i[0]==="bottom")l=b+d/2,m=c+e,n=b+d/2,o=c;else if(i[0]==="left")l=b,m=c+e/2,n=b+d,o=c+e/2;else if(~i[0].indexOf("deg")){var v,w,x,y,z,A,B,C,D=Math.PI,E=b+d/2,F=c+e/2;v=parseFloat(i)%360*D/180,w=v,v>=0&&v<D/2?(A=b+d,B=c):v>=D/2&&v<D?(C=F,F=E,B=b,A=C,E=c):v>=D&&v<D*1.5?(C=F,A=E,E=b,F=c+e,B=C):v>=D*1.5&&v<D*2&&(C=F,F=b+d,B=E,A=c+e,E=C),v=v%(D/2),x=Math.atan(Math.abs(F-B)/Math.abs(A-E)),y=Math.sqrt(Math.pow(F-B,2)+Math.pow(E-A,2)),z=y*Math.cos(x-v),w>=0&&w<D/2?(n=E+z*Math.cos(v),o=F-z*Math.sin(v),l=E*2-n,m=F*2-o):w>=D/2&&w<D?(n=F-z*Math.cos(D/2-v),o=A-z*Math.sin(D/2-v),l=F*2-n,m=A*2-o):w>=D&&w<D*1.5?(n=A+z*Math.cos(D-v),o=B+z*Math.sin(D-v),l=A*2-n,m=B*2-o):w>=D*1.5&&w<D*2&&(n=B-z*Math.cos(D*1.5-v),o=E-z*Math.sin(D*1.5-v),l=B*2-n,m=E*2-o)}}else~i.indexOf("top")&&~i.indexOf("left")?(l=b,m=c,n=b+d,o=c+e):~i.indexOf("top")&&~i.indexOf("right")?(l=b+d,m=c,n=b,o=c+e):~i.indexOf("bottom")&&~i.indexOf("left")?(l=b,m=c+e,n=b+d,o=c):~i.indexOf("bottom")&&~i.indexOf("right")&&(l=b+d,m=c+e,n=b,o=c);f=this.core.canvas.createLinearGradient(l,m,n,o),t=this.getColorStops(f,g.slice(k),s);for(u=0;u<t.length;u++)f.addColorStop(t[u].pos/100,t[u].color);return f},getRadialGradient:function(a,b,c,e,f){var g,h=["left","center","right"],i=["top","center","bottom"],j={left:b,center:b+e/2,right:b+e},k={top:c,center:c+f/2,bottom:c+f},l=["closest-side","closest-corner","farthest-side","farthest-corner","contain","cover"],m,n,o,p,q,r=[],s,t,u,v=0,w=[{x:d,y:d,r:0},{x:d,y:d,r:d}],x,y,z,A,B=!1;m=/\((.*)\)/.exec(a)[1];while(p=/((hsl|hsla|rgb|rgba)\(.*?\))/.exec(m))q=r.push(p[1])-1,m=m.substring(0,p.index)+"###"+q+"###"+m.substring(p.index+p[1].length,m.length);m=m.split(/\s*,\s*/),o=m.length;for(n=0;n<2;n++)if(~m[n].indexOf(" ")){u=m[n].split(" ");if(u[0]==="center")w[n].x=u[0],w[n].y=u[1],v=n+1;else if(~h.indexOf(u[0]))w[n].x=u[0],v=n+1,~i.indexOf(u[1])&&(w[n].y=u[1]);else if(~i.indexOf(u[0]))w[n].y=u[0],v=n+1,~h.indexOf(u[1])&&(w[n].x=u[1]);else if(!isNaN(parseFloat(u[0]))){w[n].x=u[0],v=n+1;if(~i.indexOf(u[1])||!isNaN(parseFloat(u[1])))w[n].y=u[1]}w[n].x||(w[n].x="center"),w[n].y||(w[n].y="center")}else~h.indexOf(m[n])?(w[n].x=m[n],v=n+1):~i.indexOf(m[n])?(w[n].y=m[n],v=n+1):n===1?w[n].x=w[0].x:w[n].x="center",n===1?w[n].y=w[0].y:w[n].y="center";~l.indexOf(m[v])&&(A=m[v],B=!0);if(~m[v].indexOf("px")||~m[v].indexOf("%"))A=parseFloat(m[v]),B=!0,isNaN(A)&&(A=0);A===d&&(A="cover");for(n=0;n<2;n++){w[n].abs_x=j[w[n].x],w[n].abs_y=k[w[n].y];for(x=0;x<2;x++)y="abs_"+(x===0?"x":"y"),w[n][y]===d&&(w[n][y]=parseFloat(w[n][y==="abs_x"?"x":"y"]),isNaN(w[n][y])&&(w[n][y]=y==="abs_x"?j.center-b:k.center-c),~w[n][y==="abs_x"?"x":"y"].indexOf("%")&&(w[n][y]=w[n][y]/100*(y==="abs_x"?e:f)),w[n][y]+=y==="abs_x"?b:c)}~l.indexOf(A)&&(A==="closest-side"||A==="contain"?A=Math.min(Math.abs(w[1].abs_y-c),Math.abs(c+f-w[1].abs_y),Math.abs(w[1].abs_x-b),Math.abs(b+e-w[1].abs_y)):A==="closest-corner"?A=Math.min(Math.sqrt(Math.pow(w[1].abs_x-b,2)+Math.pow(w[1].abs_y-c,2)),Math.sqrt(Math.pow(b+e-w[1].abs_x,2)+Math.pow(w[1].abs_y-c,2)),Math.sqrt(Math.pow(b+e-w[1].abs_x,2)+Math.pow(c+f-w[1].abs_y,2)),Math.sqrt(Math.pow(w[1].abs_x-b,2)+Math.pow(c+f-w[1].abs_y,2))):A==="farthest-corner"||A==="cover"?A=Math.max(Math.sqrt(Math.pow(w[1].abs_x-b,2)+Math.pow(w[1].abs_y-c,2)),Math.sqrt(Math.pow(b+e-w[1].abs_x,2)+Math.pow(w[1].abs_y-c,2)),Math.sqrt(Math.pow(b+e-w[1].abs_x,2)+Math.pow(c+f-w[1].abs_y,2)),Math.sqrt(Math.pow(w[1].abs_x-b,2)+Math.pow(c+f-w[1].abs_y,2))):A==="farthest-side"?A=Math.max(Math.abs(w[1].abs_y-c),Math.abs(c+f-w[1].abs_y),Math.abs(w[1].abs_x-b),Math.abs(b+e-w[1].abs_y)):A=0),~m[v].indexOf("%")&&(~m[v].indexOf(" ")?z=m[v].split(" ")[1]==="height"?f:e:z=e,A=A/100*z),w[1].r=A,g=this.core.canvas.createRadialGradient(w[0].abs_x,w[0].abs_y,w[0].r,w[1].abs_x,w[1].abs_y,w[1].r),s=this.getColorStops(g,m.slice(v+(B?1:0)),r);for(t=0;t<s.length;t++)g.addColorStop(s[t].pos/100,s[t].color);return g},getColorStops:function(a,b,c){var e,f=b.length,g,h,i,j,k=[];for(e=0;e<f;e++){g=b[e].trim();if(j>=100)break;~g.indexOf(" ")?(h=g.split(" "),i=h[0],j=h[1],~j.indexOf("px")?j=parseFloat(j)/Math.sqrt(Math.pow(eX-sX,2)+Math.pow(eY-sY,2))*100:j=parseFloat(j)):(i=g,j===d?j=0:j=j+(100-j)/(f-e)),~i.indexOf("###")&&(i=c[/###(\d+)###/.exec(i)[1]]),k.push({pos:j,color:i})}return k},getFont:function(a,b){b=b==="string"?"string":"object";if(typeof a=="object"&&b==="string"){var c=a;a=typeof c.style=="string"?c.style:"normal",a+=" "+(typeof c.variant=="string"?c.variant:"normal"),a+=" "+(typeof c.weight=="string"?c.weight:"normal"),a+=" "+(typeof c.size=="number"?~~(c.size*10+.5)/10+"px":"16px"),a+="/"+(typeof c.lineHeight=="number"?~~(c.lineHeight*10+.5)/10:1.5),a+=" "+(typeof c.family=="string"?c.family:"sans-serif")}if(a.length>0){var d=a.split(" "),e=d.length,f,a,g,h,i="",j=["normal","italic","oblique"],k=["normal","small-caps"],l=["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900"],m={};for(f=0;f<e;f++){a=d[f];if(~j.indexOf(a)&&!m.style)m.style=a;else if(~k.indexOf(a)&&!m.variant)m.variant=a;else if(~l.indexOf(a)&&!m.weight)m.weight=a;else if(~a.indexOf("/")&&!m.size&&!m.lineHeight)g=a.split("/"),isNaN(parseInt(g[0]))||(m.size=parseInt(g[0])),isNaN(parseFloat(g[1]))||(m.lineHeight=parseFloat(g[1]));else if(!m.size&&/\d+[a-z]{2}(?!\/)/.test(a))isNaN(parseInt(a))||(m.size=parseInt(a));else if(isNaN(parseInt(a))&&!m.family){i="";for(h=f;h<e;h++)i+=d[h]+(h===e-1?"":" ");m.family=i}}}d=m||{},d.style=d.style?d.style:"normal",d.variant=d.variant?d.variant:"normal",d.weight=d.weight?d.weight:"normal",d.size=d.size?d.size:16,d.lineHeight=d.lineHeight?d.lineHeight:1,d.family=d.family?d.family:"sans-serif";if(b==="string")return d.style+" "+d.variant+" "+d.weight+" "+d.size+"px/"+d.lineHeight+" "+d.family;if(b==="object")return d},getShadow:function(a,b){var c={},d;if(typeof a=="object")c.offsetX=isNaN(parseFloat(a.offsetX))?0:parseFloat(a.offsetX),c.offsetY=isNaN(parseFloat(a.offsetY))?0:parseFloat(a.offsetY),c.blur=isNaN(parseFloat(a.blur))?0:parseFloat(a.blur),c.color=this.isColor(a.color)?a.color:"#000";else if(typeof a=="string"){var d=/^(.*?)\s(.*?)\s(.*?)\s(.*?)$/.exec(a);c.offsetX=isNaN(parseFloat(d[1]))?0:parseFloat(d[1]),c.offsetY=isNaN(parseFloat(d[2]))?0:parseFloat(d[2]),c.blur=isNaN(parseFloat(d[3]))?0:parseFloat(d[3]),c.color=this.isColor(d[4])?d[4]:"#000"}return b==="string"?c.offsetX+"px "+c.offsetY+"px "+c.blur+"px "+c.color:c},isColor:function(a){return typeof a!="string"||a[0]!=="#"&&a.substr(0,4)!=="rgb("&&a.substr(0,5)!=="rgba("&&a.substr(0,4)!=="hsl("&&a.substr(0,5)!=="hsla("?!1:!0}}};e.registerModule("style",q);var r=function(){return{durations:{"short":500,normal:1e3,"long":2e3},defaults:{duration:"normal",easing:"ease-in-out"},queue:{activeAnimations:{},lastID:0},easing:{"ease-in":function(a){return this.cubicBezier(.42,0,1,1,a)},"ease-out":function(a){return this.cubicBezier(0,0,.58,1,a)},"ease-in-out":function(a){return this.cubicBezier(.42,0,.58,1,a)},linear:function(a){return a},cubicBezier:function(a,b,c,d,e){var f=0,g=0,h=1,i=1,j=h-3*c+3*a-f,k=3*c-6*a+3*f,l=3*a-3*f,m=f,n=i-3*d+3*b-g,o=3*d-6*b+3*g,p=3*b-3*g,q=g,r=e,s=5,t,u,v,w;for(t=0;t<s;t++)v=j*r*r*r+k*r*r+l*r+m,u=1/(3*j*r*r+2*k*r+l),r-=(v-e)*u,r=r>1?1:r<0?0:r;w=Math.abs(n*r*r*r+o*r*r+p*r*q);return w}},animate:function(a,b,c,e){function s(a){return typeof a=="function"?a:j}function r(a,c){if(typeof a=="function"&&c===b.length-2)return a;if(this.easing[a])return this.easing[a];if(typeof a=="string"&&~a.indexOf("cubic-bezier")){var d,e,f,g,h;h=a.match(/cubic-bezier\(\s*(.*?),\s*(.*?),\s*(.*?),\s*(.*?)\)/),d=isNaN(parseFloat(h[1]))?0:parseFloat(h[1]),e=isNaN(parseFloat(h[2]))?0:parseFloat(h[2]),f=isNaN(parseFloat(h[3]))?1:parseFloat(h[3]),g=isNaN(parseFloat(h[4]))?1:parseFloat(h[4]);return function(a){return this.cubicBezier(d,e,f,g,a)}}return i}function q(a){return this.durations[a]?this.durations[a]:isNaN(parseInt(a))?this.durations[h]:parseInt(a)}b=Array.prototype.slice.call(b),c=c||!1,e=e||!1;if(b[0].constructor!==Object)return!1;this.queue[a.id]||(this.queue[a.id]=[]);var f=this,g=b[0],h=this.defaults.duration,i=this.easing[this.defaults.easing],j=function(){},k=this.queue,l=k[a.id],m,n,o={},p=0;if(c!==!0){l.push({id:++k.lastID,start:function(){f.animate(a,b,!0,this.id)}});if(!k.activeAnimations[a.id]){k.activeAnimations[a.id]=l[0].id,l[0].start(),l.splice(0,1);return}}else{h=q.call(this,b[1]),i=r.call(this,b[1],1),i=r.call(this,b[2],2),j=s.call(this,b[1]),j=s.call(this,b[2]),j=s.call(this,b[3]);for(m in g)o[m]=a[m];(function t(){var b,c,m,n,q;p+=1e3/f.core.settings.fps;for(b in g){c=g[b],m=o[b],q=i.call(f.easing,p/h)*(c-m)+m;if(m<c&&q<=c||m>c&&q>=c)a[b]=q}if(p<h&&k.activeAnimations[a.id]===e)f.core.draw.redraw(!0),setTimeout(t,1e3/f.core.settings.fps);else if(k.activeAnimations[a.id]===e){for(b in g)a[b]=g[b];f.core.draw.redraw(!0),k.activeAnimations[a.id]=!1,j.call(a);if(l[0]!==d){k.activeAnimations[a.id]=l[0].id,l[0].start(),l.splice(0,1);return}}})()}},stop:function(a){this.queue[a]!==d&&(this.queue.activeAnimations[a]=!1,delete this.queue[a],this.core.draw.redraw(!0))}}};e.registerModule("animation",r);var s=function(){var a=function(a,b,c,d,e){var f=e.style.getStroke(a.stroke);f[b]=c,a.stroke=e.style.getStroke(f,"string")};return{id:0,shapeType:"rectangular",type:"",origin:{x:0,y:0},drawn:!1,events:{},children:[],opacity:1,rotation:0,composition:"source-over",scalingX:1,scalingY:1,_:{x:0,y:0,abs_x:0,abs_y:0,rotation:0,width:0,height:0,stroke:"",strokeColor:"",strokeWidth:0,strokePosition:"center",cap:"butt",join:"miter",miterLimit:10,fill:"",shadow:{offsetX:0,offsetY:0,blur:0,color:"transparent"}},set strokeColor(b){a(this,"color",b,"strokeColor",this.core)},set strokeWidth(b){a(this,"width",b,"strokeWidth",this.core)},set strokePosition(b){a(this,"pos",b,"strokePosition",this.core)},set stroke(a){typeof a!="string"&&(a=this.core.style.getStroke(a,"string"));var b=this.core.style.getStroke(a);if(~b.color.indexOf("image(")){var c=/image\((.*?)(,(\s|)(repeat|repeat-x|repeat-y|no-repeat)|)\)/.exec(b.color),d=c[1],e=c[4]||"repeat",f=new Image,g=this;f.src=d,this._.strokepattern_loading=!0,this._.strokepattern_redraw=!1,f.onload=function(){g._.strokeColor=g.core.canvas.createPattern(this,e),g._.strokepattern_loading=!1,g._.strokepattern_redraw&&(g._.strokepattern_redraw=!1,g.redraw())}}else this._.strokeColor=b.color;this._.strokeWidth=b.width,this._.strokePosition=b.pos,this._.stroke=a},set cap(a){var b=["butt","round","square"];this._.cap=~b.indexOf(a)?a:"butt"},set join(a){var b=["round","bevel","miter"];this._.join=~b.indexOf(a)?a:"miter"},set miterLimit(a){this._.miterLimit=isNaN(parseFloat(a))?10:parseFloat(a)},get stroke(){return this._.stroke},get strokeColor(){if(this._.strokepattern_loading){this._.strokepattern_redraw=!0;return""}if(~(this._.strokeColor+"").indexOf("CanvasPattern"))return this._.strokeColor;if(!~this._.strokeColor.indexOf("gradient"))return this._.strokeColor;var a=this.getOrigin();if(this.shapeType==="rectangular"){var b=this.strokePosition==="outside"?this.strokeWidth:this.strokePosition==="center"?this.strokeWidth/2:0;return this.core.style.getGradient(this._.strokeColor,this.abs_x-a.x-b,this.abs_y-a.y-b,this.width+b*2,this.height+b*2)}if(this.shapeType==="radial"){var c=this.radius+this.strokeWidth/2;return this.core.style.getGradient(this._.strokeColor,this.abs_x-a.x-this.radius,this.abs_y-a.y-this.radius,c*2,c*2)}},get strokeWidth(){return this._.strokeWidth},get strokePosition(){return this._.strokePosition},get cap(){return this._.cap},get join(){return this._.join},get miterLimit(){return this._.miterLimit},set fill(a){if(~a.indexOf("image(")){var b=/image\((.*?)(,(\s|)(repeat|repeat-x|repeat-y|no-repeat)|)\)/.exec(a),c=b[1],d=b[4]||"repeat",e=new Image,f=this;e.src=c,this._.pattern_loading=!0,this._.pattern_redraw=!1,e.onload=function(){f._.fill=f.core.canvas.createPattern(this,d),f._.pattern_loading=!1,f._.pattern_redraw&&(f._.pattern_redraw=!1,f.redraw())}}else this._.fill=a},get fill(){if(this._.pattern_loading){this._.pattern_redraw=!0;return""}if(~(this._.fill+"").indexOf("CanvasPattern"))return this._.fill;if(!~this._.fill.indexOf("gradient"))return this._.fill;var a=this.getOrigin();if(this.shapeType==="rectangular")return this.core.style.getGradient(this._.fill,this.abs_x-a.x,this.abs_y-a.y,this.width,this.height);if(this.shapeType==="radial")return this.core.style.getGradient(this._.fill,this.abs_x-a.x-this.radius,this.abs_y-a.y-this.radius,this.radius*2,this.radius*2)},set shadow(a){typeof a!="string"&&(a=this.core.style.getShadow(a,"string"));var b=this.core.style.getShadow(a);this._.shadow=b},set shadowOffsetX(a){isNaN(parseFloat(a))||(this._.shadow.offsetX=parseFloat(a))},set shadowOffsetY(a){isNaN(parseFloat(a))||(this._.shadow.offsetY=parseFloat(a))},set shadowBlur(a){isNaN(parseFloat(a))||(this._.shadow.blur=parseFloat(a))},set shadowColor(a){this.core.style.isColor(a)&&(this._.shadow.color=a)},get shadow(){return this._.shadow},get shadowOffsetX(){return this._.shadow.offsetX},get shadowOffsetY(){return this._.shadow.offsetY},get shadowBlur(){return this._.shadow.blur},get shadowColor(){return this._.shadow.color},set x(a){this._.x=a,this._.abs_x=a+(this.parent!==d?this.parent.abs_x:0);var b=this.children,c=b.length,e;for(e=0;e<c;e++)b[e]._.abs_x=this.abs_x+b[e].x,b[e].x+=0},set y(a){this._.y=a,this._.abs_y=a+(this.parent!==d?this.parent.abs_y:0);var b=this.children,c=b.length,e;for(e=0;e<c;e++)b[e]._.abs_y=this.abs_y-b[e].y,b[e].y+=0},get x(){return this._.x},get y(){return this._.y},set abs_x(a){return},set abs_y(a){return},get abs_x(){return this._.abs_x},get abs_y(){return this._.abs_y},set width(a){var b=this._.width;this._.width=a;var c=this.children,d=c.length,e;for(e=0;e<d;e++)c[e].width=c[e].width-b+a},get width(){return this._.width},set height(a){var b=this._.height;this._.height=a;var c=this.children,d=c.length,e;for(e=0;e<d;e++)c[e].height=c[e].height-b+a},get height(){return this._.height},bind:function(a,b){this.core.events.bind(this,a,b);return this},unbind:function(a,b){this.core.events.unbind(this,a,b);return this},trigger:function(a){this.core.events.trigger(this,a);return this},add:function(){if(this.drawn===!1){this.id=this.core.draw.add(this),this.core.redraw(),this.drawn=!0;var a=this.children,b=a.length,c;for(c=0;c<b;c++)a[c].add()}return this},remove:function(){this.core.draw.remove(this.id),this.drawn=!1;var a=this.children,b=a.length,c;for(c=0;c<b;c++)a[c].remove();return this},draw:function(){},redraw:function(){this.core.draw.redraw();return this},rotate:function(a){this.rotation+=a;return this},rotateTo:function(a){this.rotation=a;return this},getArgs:function(a,b,c,e){c=c||0,e=e||0;if(typeof b=="string"){var f=b,g=a;a=f==="x"?g:c,b=f==="y"?g:e}else b===d&&(b=a);return{x:a,y:b}},move:function(a,b){var c=this.getArgs(a,b);this.x+=c.x,this.y+=c.y;return this},moveTo:function(a,b){var c=this.getArgs(a,b,this.x,this.y);this.x=c.x,this.y=c.y;return this},scale:function(a,b){var c=this.getArgs(a,b,1,1);this.scalingX=c.x,this.scalingY=c.y;return this},scaleTo:function(a,b){var c=this.shapeType==="rectangular"?this.width:this.radius,d=this.shapeType==="rectangular"?this.height:this.radius,e=this.getArgs(a,b,c,d);e.x=e.x<=0?1:e.x,e.y=e.y<=0?1:e.y,this.scalingX=e.x/c,this.scalingX=e.y/d;return this},animate:function(){this.core.animation.animate(this,arguments);return this},stop:function(){this.core.animation.stop(this.id);return this},fadeIn:function(){var a=Array.prototype.slice.call(arguments);this.core.animation.animate(this,[{opacity:1}].concat(a));return this},fadeOut:function(){var a=Array.prototype.slice.call(arguments);this.core.animation.animate(this,[{opacity:0}].concat(a));return this},fadeTo:function(){var a=Array.prototype.slice.call(arguments);this.core.animation.animate(this,[{opacity:a.splice(0,1)[0]}].concat(a));return this},dragAndDrop:function(a){a=a===d?{}:a;if(a===!1&&this.draggable===!0)this.draggable=!1,this.unbind("mousedown touchstart",this._.drag_start),this.core.unbind("mouseup touchend",this._.drag_end),this.core.unbind("mousemove touchmove",this._.drag_move);else if(!this.draggable){this.draggable=!0,this.dragging=!1;var b=this,c={x:0,y:0};this._.drag_start=function(b){this.dragging=!0,c.x=b.x-this.x,c.y=b.y-this.y,typeof a.start=="function"&&a.start.call(this),this.core.timeline.running||this.core.draw.redraw()},this._.drag_end=function(){b.dragging=!1,typeof a.end=="function"&&a.end.call(b),b.core.timeline.running||b.core.draw.redraw()},this._.drag_move=function(d){b.dragging&&(b.x=d.x-c.x,b.y=d.y-c.y,typeof a.move=="function"&&a.move.call(b),b.core.timeline.running||b.core.draw.redraw())},this.bind("mousedown touchstart",this._.drag_start),this.core.bind("mouseup touchend",this._.drag_end),this.core.bind("mousemove touchmove",this._.drag_move)}return this},setOrigin:function(a,b){this.origin.x=a,this.origin.y=b;return this},getOrigin:function(){var a,b,c=this.origin,d=this.shapeType;c.x==="center"?a=d==="rectangular"?this.width/2:0:c.x==="right"?a=d==="rectangular"?this.width:this.radius:c.x==="left"?a=d==="rectangular"?0:-this.radius:a=isNaN(parseFloat(c.x))?0:parseFloat(c.x),c.y==="center"?b=d==="rectangular"?this.height/2:0:c.y==="bottom"?b=d==="rectangular"?this.height:this.radius:c.y==="top"?b=d==="rectangular"?0:-this.radius:b=isNaN(parseFloat(c.y))?0:parseFloat(c.y);return{x:a,y:b}},addChild:function(a,b){if(a.parent===d){var c=this.children.push(a)-1;a.parent=this,a.x+=0,a.y+=0,this.drawn&&a.add();if(b)return c}else if(b)return!1;return this},removeChild:function(a){var b=this.children.indexOf(a);~b&&this.removeChildAt(b);return this},removeChildAt:function(a){this.children[a]!==d&&(this.children[a].remove(),this.children[a].parent=d,this.children.splice(a,1));return this},clone:function(a){a=a||{},a.drawn=!1;var b=this.core.display[this.type](a),c={},f=["core","events","children","parent","img","fill","strokeColor"],g,h,i;g=function(a,b){for(h in a){if(~f.indexOf(h))continue;if(typeof a[h]=="object"){b[h]=a[h].constructor===Array?[]:{},g(a[h],b[h]);continue}a.__lookupGetter__(h)===d&&(b[h]=a[h])}},g(this,c),c.fill=this._.fill,i=this.core.style.getStroke(this.stroke),c.strokeColor=i.color,b=e.extend(b,c,a),typeof b.init=="function"&&b.init();return b},isPointerInside:function(a){return this.core.tools.isPointerInside(this,a)}}},t=function(a,b,c,f){var g=this,h=this.core,i=function(d,f){return e.extend({core:f,type:a,shapeType:"rectangular",draw:function(){c.call(this,h.canvas,h);return this}},b,d)};this[a]=function(b){var c=e.extend(Object.create(s()),new i(b,h));f!==d&&typeof g[a][f]=="function"&&g[a][f]();return c};return g};e.registerModule("displayObject",s),e.registerModule("display",{wrapper:!0,register:t}),e.registerDisplayObject=function(a,b,c){e.registerModule("display."+a,{setCore:function(f){return function(g){var h=e.extend(Object.create(s()),new b(g,f));h.type=a,c!==d&&h[c]();return h}}})};var u=function(a,b){return e.extend({core:b,shapeType:"rectangular",draw:function(){var a=this.core.canvas,b=this.getOrigin(),c=this.abs_x-b.x,d=this.abs_y-b.y;a.beginPath(),this.fill!==""&&(a.fillStyle=this.fill,a.fillRect(c,d,this.width,this.height)),this.strokeWidth>0&&(a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,this.strokePosition==="outside"?a.strokeRect(c-this.strokeWidth/2,d-this.strokeWidth/2,this.width+this.strokeWidth,this.height+this.strokeWidth):this.strokePosition==="center"?a.strokeRect(c,d,this.width,this.height):this.strokePosition==="inside"&&a.strokeRect(c+this.strokeWidth/2,d+this.strokeWidth/2,this.width-this.strokeWidth,this.height-this.strokeWidth)),a.closePath();return this}},a)};e.registerDisplayObject("rectangle",u);var v=function(a,b){return e.extend({core:b,shapeType:"rectangular",loaded:!1,firstDrawn:!1,tile:!1,tile_width:0,tile_height:0,tile_spacing_x:0,tile_spacing_y:0,init:function(){var a=this,b=this.image.nodeName&&this.image.nodeName.toLowerCase()==="img"?"htmlImg":"newImg";this.img=b==="htmlImg"?this.image.cloneNode(!1):new Image,this.core.canvasElement.appendChild(this.img),this.img.onload=function(){a.loaded=!0,a.width!==0?a.height===0&&(a.height=a.width/(this.width/this.height)):a.width=this.width,a.height!==0?a.width===0&&(a.width=a.height/(this.height/this.width)):a.height=this.height,a.tile_width=a.tile_width===0?a.width:a.tile_width,a.tile_height=a.tile_height===0?a.height:a.tile_height,a.core.canvasElement.removeChild(this),a.core.redraw()},b==="newImg"&&(this.img.src=this.image)},draw:function(){var a=this.core.canvas,b=this,c=this.getOrigin(),e=this.abs_x-c.x,f=this.abs_y-c.y,g,h;if(this.loaded&&this.core.draw.objects[this.id]!==d&&this.img.width>0&&this.img.height>0){g=this.width===0?this.img.width:this.width,h=this.height===0?this.img.height:this.height;if(this.tile){var i=Math.ceil(g/this.tile_width),j=Math.ceil(h/this.tile_height),k,l;a.save(),a.beginPath(),a.moveTo(e,f),a.lineTo(e+g,f),a.lineTo(e+g,f+h),a.lineTo(e,f+h),a.lineTo(e,f),a.clip();for(l=0;l<j;l++)for(k=0;k<i;k++)a.drawImage(this.img,e+k*(this.tile_width+this.tile_spacing_x),f+l*(this.tile_height+this.tile_spacing_y),this.tile_width,this.tile_height);a.closePath(),a.restore()}else a.drawImage(this.img,e,f,g,h);this.strokeWidth>0&&(a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.strokeRect(e,f,g,h)),this.firstDrawn===!1&&(this.firstDrawn=!0,clearTimeout(this.loadtimer))}else clearTimeout(this.loadtimer),this.loadtimer=setTimeout(function(){b.draw()},100);return this}},a)};e.registerDisplayObject("image",v,"init");var w=function(a,b){var c=function(a,b,c,d,e){var f=e.style.getFont(a.font);f[b]=c,a._.font=e.style.getFont(f,"string"),a._[d]=c};return e.extend({core:b,shapeType:"rectangular",align:"start",baseline:"top",_:e.extend({},b.displayObject._,{font:"normal normal normal 16px/1 sans-serif",style:"normal",variant:"normal",weight:"normal",size:16,lineHeight:1,family:"sans-serif",text:"",width:0,height:0}),set font(a){typeof a!="string"&&(a=this.core.style.getFont(a,"string"));var b=this.core.style.getFont(a);a=this.core.style.getFont(b,"string"),this._.style=b.style,this._.variant=b.variant,this._.weight=b.weight,this._.size=b.size,this._.lineHeight=b.lineHeight,this._.family=b.family,this._.font=a,this.setDimensions()},set style(a){c(this,"style",a,"style",this.core),this.setDimensions()},set variant(a){c(this,"variant",a,"variant",this.core),this.setDimensions()},set weight(a){c(this,"weight",a,"weight",this.core),this.setDimensions()},set size(a){c(this,"size",a,"size",this.core),this.setDimensions()},set lineHeight(a){c(this,"lineHeight",a,"lineHeight",this.core),this.setDimensions()},set family(a){c(this,"family",a,"family",this.core),this.setDimensions()},set text(a){this._.text=a,this.setDimensions()},set width(a){return},set height(a){return},get font(){return this._.font},get style(){return this._.style},get variant(){return this._.variant},get weight(){return this._.weight},get size(){return this._.size},get lineHeight(){return this._.lineHeight},get family(){return this._.family},get text(){return this._.text},get width(){return this._.width},get height(){return this._.height},init:function(){this._.initialized=!0,this.setDimensions()},setDimensions:function(){if(this._.initialized){var a=this.core.canvas,b;a.fillStyle=this.fill,a.font=this.font,b=a.measureText(this.text),this._.width=b.width,this._.height=this.size}},draw:function(){var a=this.core.canvas,b=this.getOrigin(),c=this.abs_x-b.x,d=this.abs_y-b.y,e,f;a.beginPath(),a.font=this.font,a.textAlign=this.align,a.textBaseline=this.baseline,this.strokeWidth>0&&(a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.strokeText(this.text,c,d),a.stroke());if(this.fill!==""){a.fillStyle=this.fill,e=(this.text+"").split("\n");for(f=0;f<e.length;f++)a.fillText(e[f],c,d+f*this.lineHeight*this.height);a.fill()}a.closePath();return this}},a)};e.registerDisplayObject("text",w,"init");var x=function(a,b){return e.extend({core:b,shapeType:"radial",radius:0,start:0,end:0,direction:"clockwise",draw:function(){var a=this.core.canvas,b=this.getOrigin(),c=this.abs_x-b.x,d=this.abs_y-b.y;this.radius>0&&(a.beginPath(),a.arc(c,d,this.radius,this.start*Math.PI/180,this.end*Math.PI/180,this.direction==="anticlockwise"),this.fill!==""&&(a.fillStyle=this.fill,a.fill()),this.strokeWidth>0&&(a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.stroke()),a.closePath());return this}},a)};e.registerDisplayObject("arc",x);var y=function(a,b){return e.extend({core:b,shapeType:"radial",_:e.extend({},b.displayObject._,{radius_x:0,radius_y:0}),set radius(a){this._.radius_x=a,this._.radius_y=a},set radius_x(a){this._.radius_x=a},set radius_y(a){this._.radius_y=a},get radius(){return this._.radius_x},get radius_x(){return this._.radius_x},get radius_y(){return this._.radius_y},draw:function(){var a=this.core.canvas,b=this.getOrigin(),c=this.abs_x-b.x,d=this.abs_y-b.y;a.beginPath();if(this.radius_x===this.radius_y)a.arc(c,d,this.radius_x,0,Math.PI*2,!1);else{var e=.276142374915397,f={x:this.radius_x*2*e,y:this.radius_y*2*e};a.moveTo(c-this.radius_x,d),a.bezierCurveTo(c-this.radius_x,d-f.y,c-f.x,d-this.radius_y,c,d-this.radius_y),a.bezierCurveTo(c+f.x,d-this.radius_y,c+this.radius_x,d-f.y,c+this.radius_x,d),a.bezierCurveTo(c+this.radius_x,d+f.y,c+f.x,d+this.radius_y,c,d+this.radius_y),a.bezierCurveTo(c-f.x,d+this.radius_y,c-this.radius_x,d+f.y,c-this.radius_x,d)}this.fill!==""&&(a.fillStyle=this.fill,a.fill()),this.strokeWidth>0&&(a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.stroke()),a.closePath();return this}},a)};e.registerDisplayObject("ellipse",y);var z=function(a,b){return e.extend({core:b,shapeType:"radial",sides:3,_:e.extend({},b.displayObject._,{radius:0,side:0}),set radius(a){this._.radius=a,this._.side=2*this._.radius*Math.sin(Math.PI/this.sides)},set side(a){this._.side=a,this._.radius=this._.side/2/Math.sin(Math.PI/this.sides)},get radius(){return this._.radius},get side(){return this._.side},draw:function(){var a=this.core.canvas,b=this.getOrigin(),c=this.abs_x-b.x,d=this.abs_y-b.y,e={x:0,y:0},f=this.sides,g=this.radius,h,i,j;a.beginPath();for(j=0;j<=f;j++)h=c+g*Math.cos(j*2*Math.PI/f),i=d+g*Math.sin(j*2*Math.PI/f),j===0?(a.moveTo(h,i),e={x:h,y:i}):j==f?a.lineTo(e.x,e.y):a.lineTo(h,i);a.closePath(),this.fill!==""&&(a.fillStyle=this.fill,a.fill()),this.strokeWidth>0&&(a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.stroke());return this}},a)};e.registerDisplayObject("polygon",z);var A=function(a,b){return e.extend({core:b,shapeType:"radial",_:e.extend({},b.displayObject._,{start_x:0,start_y:0,end_x:0,end_y:0,x:200,y:0,abs_x:0,abs_y:0}),children:[],set start(a){this._.start_x=a.x,this._.start_y=a.y,this.setPosition()},set end(a){this._.end_x=a.x,this._.end_y=a.y,this.setPosition()},get start(){return{x:this._.start_x,y:this._.start_y}},get end(){return{x:this._.end_x,y:this._.end_y}},set x(a){var b=this._.end_x-this._.start_x;this._.x=a,this._.abs_x=a+(this.parent!==d?this.parent.abs_x:0),this._.start_x=a-b/2+(this._.abs_x-this._.x),this._.end_x=a+b/2+(this._.abs_x-this._.x);var c=this.children,e=c.length,f;for(f=0;f<e;f++)c[f]._.abs_x=this.abs_x+c[f].x,c[f].x+=0},set y(a){var b=this._.end_y-this._.start_y;this._.y=a,this._.abs_y=a+(this.parent!==d?this.parent.abs_y:0),this._.start_y=a-b/2+(this._.abs_y-this._.y),this._.end_y=a+b/2+(this._.abs_y-this._.y);var c=this.children,e=c.length,f;for(f=0;f<e;f++)c[f]._.abs_y=this.abs_y-c[f].y,c[f].y+=0},get x(){return this._.x},get y(){return this._.y},set length(a){var b,c,d,e;b=Math.abs(this._.end_x-this._.start_x),c=Math.abs(this._.end_y-this._.start_y),d=Math.sqrt(b*b+c*c),e=Math.asin(b/d),b=Math.sin(e)*a,c=Math.cos(e)*a,this._.end_x=this._.start_x+b,this._.end_y=this._.start_y+c,this.x+=0,this.y+=0},get length(){var a,b,c;a=Math.abs(this._.end_x-this._.start_x),b=Math.abs(this._.end_y-this._.start_y),c=Math.sqrt(a*a+b*b);return c},set radius(a){this.length=a*2},get radius(){return this.length/2},setPosition:function(){this.initialized&&(this.x=this._.start_x+(this._.end_x-this._.start_x)/2,this.y=this._.start_y+(this._.end_y-this._.start_y)/2)},init:function(){this.initialized=!0,this.setPosition()},draw:function(){var a=this.core.canvas,b=this.getOrigin(),c=this.core.draw.translation;a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.beginPath(),a.moveTo(this.start.x-c.x-b.x,this.start.y-c.y-b.y),a.lineTo(this.end.x-c.x-b.x,this.end.y-c.y-b.y),a.stroke(),a.closePath();return this}},a)};e.registerDisplayObject("line",A,"init");var B=function(a,b){return e.extend({core:b,shapeType:"rectangular",loaded:!1,firstDrawn:!1,frames:[],duration:0,frame:1,generate:!1,offset_x:0,offset_y:0,direction:"x",running:!1,active:!1,loop:!0,_:e.extend({},b.displayObject._,{autostart:!1}),set autostart(a){this.active=a,this._.autostart=a},get autostart(){return this._.autostart},init:function(){if(this.image!==d){var a=this,b=this.image.nodeName&&this.image.nodeName.toLowerCase()==="img"?"htmlImg":"newImg";this.img=b==="htmlImg"?this.image.cloneNode(!1):new Image,this.core.canvasElement.appendChild(this.img),this.img.onload=function(){a.full_width=this.width,a.full_height=this.height;if(a.generate){var b=a.direction,c=b==="y"?a.full_height:a.full_width,d=b==="y"?a.height:a.width,e=c/d,f;a.frames=[];for(f=0;f<e;f++)a.frames.push({x:a.offset_x+f*(b==="x"?a.width:0),y:a.offset_y+f*(b==="y"?a.height:0),d:a.duration})}a.core.canvasElement.removeChild(this),a.loaded=!0},b==="newImg"&&(this.img.src=this.image)}},draw:function(){var a=this,b=this.core.canvas,c=this.getOrigin(),e=this.abs_x-c.x,f=this.abs_y-c.y,g;this.loaded?(this.frames.length>0&&(g=this.frames[this.frame-1],frame_width=g.w!==d?g.w:this.width,frame_height=g.h!==d?g.h:this.height,b.drawImage(this.img,g.x,g.y,frame_width,frame_height,e,f,frame_width,frame_height),this.strokeWidth>0&&(b.lineWidth=this.strokeWidth,b.strokeStyle=this.strokeColor,b.strokeRect(e,f,frame_width,frame_height)),this.running===!1&&this.active&&(setTimeout(function(){a.loop?a.frame=a.frame===a.frames.length?1:a.frame+1:a.frame=a.frame===a.frames.length?a.frame:a.frame+1,a.running=!1,a.core.timeline.running||a.core.draw.redraw()},g.d),this.running=!0)),this.firstDrawn===!1&&(this.firstDrawn=!0,clearTimeout(this.loadtimer))):(clearTimeout(this.loadtimer),this.loadtimer=setTimeout(function(){a.draw()},100));return this},start:function(){this.active=!0,this.core.redraw();return this},stop:function(){this.active=!1;return this}},a)};e.registerDisplayObject("sprite",B,"init")})(window,document)